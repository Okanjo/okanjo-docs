<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Events : Okanjo API Core Specification</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="assets_/css/shCore.css">
        <link rel="stylesheet" href="assets_/css/shThemeDefault.css">
        <link rel="stylesheet" href="assets_/css/main.css">
    </head>
    <body data-root-path="">
        <div id="wrapper">
            <div id="content">

<ul id="topnav">
    <li><a href="index.html">Index</a></li>
    <li><a href="#toc">TOC</a></li>
</ul>
<h1 id="events">Events</h1>

<p>An Event resource is generated when something occurs on the Okanjo platform. Events can pass along greatly differing data
sets, but all will be centered around the event that took place (E.g. Data about a product being updated will be sent when
a <code>updated_product</code> event occurs. Data about these events are transmitted by webhook to a third party URL at their request.</p>

<h1 id="objects">Objects</h1>

<ul>
<li><a href="Objects.html#Event"><code>Event</code></a> â€“ Event object (transmitted to client)</li>
<li><a href="Objects.html#EventSubscription"><code>Event Subscription</code></a> - A subscription record for an event type to a URL</li>
</ul>

<h1 id="importantnotes">Important Notes</h1>

<p>If you have configured events, they will come from one of two IP addresses: <code>96.30.254.41</code> and <code>96.30.254.43</code>. These
addresses should not change, but if they do they will be reported here.</p>

<h1 id="workflowexample">Workflow Example</h1>

<p>For this example, we're going to subscribe to the event that is triggered whenever a user uploads a product to Okanjo.</p>

<p>First, make sure you have your destination endpoint and URL in place. For this example I'm using
<a href="http://requestb.in">Request Bin</a>. This is important because Okanjo will test the URL you give it before letting you
subscribe to an event. Now that you're ready to subscribe to an event, send a POST request to <code>/events/subscribe</code> with the
<code>type</code> and <code>webhook_url</code> entity data:</p>

<pre><code>type=added_product

webhook_url=http://requestb.in/1230vpw1
</code></pre>

<p>Okanjo will attempt to send a JSON-encoded POST request to the supplied <code>webhook_url</code> to test the validity:</p>

<pre class="brush:js">

["This was a triumph","I'm making a note here:","HUGE SUCCESS"]
</pre>

<p>If that POST request returns a successful response code of 200, you will receive a "success" JSON response:</p>

<pre class="brush:js">

{"type": "success"}
</pre>

<p>Now, whenever somebody adds a product to your marketplace, the system will send information about the event to
your webhook URL. The contents will look something like this, which will include the product information in the <code>data</code> section:</p>

<pre class="brush:js">

{
  "id": "EVJyCMRfV7AEEg4zVMbA"
  "occurred": "2014-11-05 12:45:35",
  "type": "added_product",
  "data": {
    "id": "120553",
    "curated": null,
    "donation_perc": "15",
    "status": "1",
    "seller_store_id": "14",
    "brand_id": "1",
    "location_zip": "53202",
    "location_name": "Milwaukee",
    "location_state": "WI",
    "stock": "105",
    "category_id": "176",
    "cause_id": "35607",
    "is_local_pickup": "0",
    "is_free_shipping": "1",
    "thumbnail_media_id": "241021",
    "created": "2014-11-05 12:45:34",
    "published": "2014-11-05 12:45:34",
    "updated": "2014-11-05 12:45:34",
    "price": "50.00",
    "slug": "120553-half-life-2-supply-crate",
    "title": "Half-Life 2 Supply Crate",
    "description": "Break it open to see what's inside! Well, don't break it open, because then you can't return it.",
    "condition": "New",
    "is_vertical": "0",
    "current_bid": null,
    "auction_start": null,
    "auction_end": null,
    "auction_min_bid": null,
    "type": "0",
    "return_policy_id": "593",
    "is_available": "1",
    "deal_start": null,
    "deal_end": null,
    "promo_start": null,
    "promo_end": null,
    "deal_value": null,
    "dma_code": "617",
    "dimensions": {
      "Contents": {
        "Healthkit": {
          "price_modifier": "0"
        },
        "Ammo": {
          "price_modifier": "0"
        },
        "Energy": {
          "price_modifier": "0"
        }
      }
    },
    "variants": {
      "Contents=Healthkit": {
        "stock": "50"
      },
      "Contents=Ammo": {
        "stock": "35"
      },
      "Contents=Energy": {
        "stock": "20"
      }
    },
    "category": {
      "id": "176",
      "parent_id": "155",
      "port": "246",
      "starboard": "247",
      "depth": "3",
      "name": "Games",
      "parents": "4,155"
    },
    "cause": {
      "id": "35607",
      "status": "2",
      "name": "Mesa Community Action Network Incorporated",
      "local_name": "Mesa Community Action Network Incorporated (Mesa)",
      "city": "Mesa",
      "state": "AZ",
      "created": "2014-11-04 17:57:46",
      "updated": "2014-11-04 17:57:46",
      "store_id": "4940",
      "store_about": "MesaCAN serves, or facilitates services for, economically disadvantaged individuals and families and helps clients devise strategies for increased self sufficiency and reduced reliance on government services.",
      "store_website_url": null,
      "store_facebook_url": null,
      "store_twitter_url": null,
      "store_avatar_media_id": null,
      "store_banner_media_id": null,
      "store_okanjo_uri": null
    },
    "store": {
      "id": "14",
      "status": "1",
      "created": "2013-07-10 17:10:16",
      "updated": "2014-08-07 11:49:04",
      "type": "1",
      "name": "Edited Store Name",
      "about": "",
      "website_url": null,
      "facebook_url": "",
      "twitter_url": "",
      "avatar_media_id": "1420",
      "banner_media_id": "240914",
      "rating_avg": "4.40",
      "okanjo_uri": "bigwayne"
    },
    "shipping": null,
    "tags": {
      "4": {
        "id": "4",
        "name": "Electronics"
      },
      "54": {
        "id": "54",
        "name": "Games"
      },
      "63": {
        "id": "63",
        "name": "Videogames"
      }
    },
    "return_policy": {
      "id": "593",
      "store_id": "14",
      "name": "No tag backs",
      "policy": "You break it, you bought it."
    },
    "media": {
      "1420": {
        "original": "https:\/\/dj01gpsbn30ii.cloudfront.net\/prod_1420_desktop_original.jpg_gmxl.jpg",
        "avatar_desktop": "https:\/\/dj01gpsbn30ii.cloudfront.net\/prod_1420_desktop_avatar.jpg_uz3p.jpg",
        "avatar_desktop_width": null,
        "avatar_desktop_height": null,
        "avatar_mobile_retina": "https:\/\/dev-api.okanjo.com\/media\/generate?id=1420&amp;format=mobile_retina&amp;size=avatar",
        "avatar_mobile_retina_width": null,
        "avatar_mobile_retina_height": null
      },
      "240914": {
        "original": "https:\/\/dj01gpsbn30ii.cloudfront.net\/dev_s4zws_240914_desktop_original.png",
        "banner_desktop": "https:\/\/dj01gpsbn30ii.cloudfront.net\/dev_ro1wl_240914_desktop_banner.png",
        "banner_desktop_width": "1280",
        "banner_desktop_height": "400",
        "banner_mobile_retina": "https:\/\/dev-api.okanjo.com\/media\/generate?id=240914&amp;format=mobile_retina&amp;size=banner",
        "banner_mobile_retina_width": null,
        "banner_mobile_retina_height": null
      },
      "241021": {
        "original": "https:\/\/dj01gpsbn30ii.cloudfront.net\/dev_8glko_241021_desktop_original.jpg",
        "listing_desktop": "https:\/\/dev-api.okanjo.com\/media\/generate?id=241021&amp;format=desktop&amp;size=listing",
        "listing_desktop_width": null,
        "listing_desktop_height": null,
        "detail_desktop": "https:\/\/dj01gpsbn30ii.cloudfront.net\/dev_11p9bp_241021_desktop_detail.jpg",
        "detail_desktop_width": "1074",
        "detail_desktop_height": "808",
        "thumbnail_desktop": "https:\/\/dj01gpsbn30ii.cloudfront.net\/dev_5jz5c_241021_desktop_thumbnail.jpg",
        "thumbnail_desktop_width": "130",
        "thumbnail_desktop_height": "130",
        "cart_desktop": "https:\/\/dev-api.okanjo.com\/media\/generate?id=241021&amp;format=desktop&amp;size=cart",
        "cart_desktop_width": null,
        "cart_desktop_height": null,
        "gallery_desktop": "https:\/\/dev-api.okanjo.com\/media\/generate?id=241021&amp;format=desktop&amp;size=gallery",
        "gallery_desktop_width": null,
        "gallery_desktop_height": null,
        "listing_fixed_desktop": "https:\/\/dev-api.okanjo.com\/media\/generate?id=241021&amp;format=desktop&amp;size=listing_fixed",
        "listing_fixed_desktop_width": null,
        "listing_fixed_desktop_height": null,
        "listing_mobile_retina": "https:\/\/dev-api.okanjo.com\/media\/generate?id=241021&amp;format=mobile_retina&amp;size=listing",
        "listing_mobile_retina_width": null,
        "listing_mobile_retina_height": null,
        "detail_mobile_retina": "https:\/\/dev-api.okanjo.com\/media\/generate?id=241021&amp;format=mobile_retina&amp;size=detail",
        "detail_mobile_retina_width": null,
        "detail_mobile_retina_height": null,
        "thumbnail_mobile_retina": "https:\/\/dev-api.okanjo.com\/media\/generate?id=241021&amp;format=mobile_retina&amp;size=thumbnail",
        "thumbnail_mobile_retina_width": null,
        "thumbnail_mobile_retina_height": null,
        "cart_mobile_retina": "https:\/\/dev-api.okanjo.com\/media\/generate?id=241021&amp;format=mobile_retina&amp;size=cart",
        "cart_mobile_retina_width": null,
        "cart_mobile_retina_height": null,
        "gallery_mobile_retina": "https:\/\/dev-api.okanjo.com\/media\/generate?id=241021&amp;format=mobile_retina&amp;size=gallery",
        "gallery_mobile_retina_width": null,
        "gallery_mobile_retina_height": null,
        "listing_fixed_mobile_retina": "https:\/\/dev-api.okanjo.com\/media\/generate?id=241021&amp;format=mobile_retina&amp;size=listing_fixed",
        "listing_fixed_mobile_retina_width": null,
        "listing_fixed_mobile_retina_height": null
      }
    },
    "meta": [

    ]
  }
}
</pre>

<p>If you did it right, well done. Now, while you trust Okanjo, you want to verify it as well.
If you send a GET request to <code>events/&lt;event_id&gt;</code>, where <code>&lt;event_id&gt;</code> in this case is the ID from above, "EVJyCMRfV7AEEg4zVMbA".
If done properly, the response you get will exactly match the data you received.</p>

<h1 id="eventtypes">Event Types</h1>

<p>This list will expand regularly. Use these for values of <code>type</code> when subscribing to events. The data that will be returned
is listed under each event type.</p>

<dl class="inline-def"><dt><p><code>added_product</code></p></dt><dd><p><a href="Objects.html#Product"><code>Product</code></a> - When a product is added.</p></dd><dt><p><code>confirmed_order</code></p></dt><dd><p><a href="Objects.html#Order"><code>Order</code></a> - When an order is made/confirmed.</p></dd><dt><p><code>disbursement_sent</code></p></dt><dd><p>Occurs when Okanjo debits money into an account.</p></dd><dt><p><code>updated_order</code></p></dt><dd><p><a href="Objects.html#Order"><code>Order</code></a> - When an order is updated (E.g. Buyer's payment came through).</p></dd><dt><p><code>updated_order_item</code></p></dt><dd><p><a href="Objects.html#OrderItem"><code>Order Item</code></a> - When an item on an order is updated (E.g. Seller marks item as shipped).</p></dd></dl>

<h1 id="routes">Routes</h1>

<p>Here are the list of API routes to interact with events.</p>

<h2 id="tableofcontentsahreftocnametocclassdeeplinka">Table of Contents <a href="#toc" name="toc" class="deep-link">#</a></h2>

<ul>
<li><a href="#POST /events/subscribe">POST /events/subscribe</a></li>
<li><a href="#GET /events/subscriptions">GET /events/subscriptions</a></li>
<li><a href="#POST /events/unsubscribe">POST /events/unsubscribe</a></li>
<li><a href="#GET /events/{id}">GET /events/{id}</a></li>
</ul>

<h2 id="posteventssubscribeahrefposteventssubscribeidposteventssubscribeclassdeeplinka">POST /events/subscribe <a href="#POST /events/subscribe" id="POST /events/subscribe" class="deep-link">#</a></h2>

<p>Resource. Subscribes a given event type to a supplied webhook URL.</p>

<h3 id="entitynvpparameters">Entity NVP Parameters</h3>

<p>Both of these parameters are mandatory.</p>

<dl class="inline-def"><dt><p><code>type</code></p></dt><dd><p><code>string</code> The type of event to subscribe to.</p></dd><dt><p><code>webhook_url</code></p></dt><dd><p><code>string</code> The URL (including scheme).</p></dd></dl>

<h3 id="returns">Returns</h3>

<p>Generic <a href="Globals.html#Default Response Object"><code>Success</code></a> object.</p>

<h4 id="errors">Errors</h4>

<dl><dt><p><strong>400 Bad Request</strong></p></dt><dd><p><code>Require {field}.</code>  Occurs when you're missing a necessary NVP parameter.</p></dd><dd><p><code>Invalid field {field}.</code>  Occurs when you have an invalid <code>type</code> field or Okanjo failed to POST to the supplied <code>webhook_url</code>, or if it was malformed.</p></dd><dt><p><strong>409 Conflict</strong></p></dt><dd><p><code>Conflict with Event Subscription</code>  Occurs when trying to subscribe to an event <code>type</code> with the same <code>webhook_url</code>.</p></dd><dt><p><strong>500 Internal Server Error</strong></p></dt><dd><p><code>Unable to handle request.</code>  Occurs when there's a system failure while attempting to subscribe to an event.</p></dd></dl>

<h2 id="geteventssubscriptionsahrefgeteventssubscriptionsidgeteventssubscriptionsclassdeeplinka">GET /events/subscriptions <a href="#GET /events/subscriptions" id="GET /events/subscriptions" class="deep-link">#</a></h2>

<p>Collection. Gets all active subscriptions</p>

<h3 id="queryparameters">Query Parameters</h3>

<p>None.</p>

<h3 id="returns">Returns</h3>

<p>Array of <a href="Objects.html#EventSubscription"><code>Event Subscription</code></a> objects.</p>

<h4 id="errors">Errors</h4>

<p>None.</p>

<h2 id="posteventsunsubscribeahrefposteventsunsubscribeidposteventsunsubscribeclassdeeplinka">POST /events/unsubscribe <a href="#POST /events/unsubscribe" id="POST /events/unsubscribe" class="deep-link">#</a></h2>

<p>Resource. Subscribes a given event type to a supplied webhook URL.</p>

<h3 id="entitynvpparameters">Entity NVP Parameters</h3>

<p>Both of these parameters are mandatory.</p>

<dl class="inline-def"><dt><p><code>type</code></p></dt><dd><p><code>string</code> The type of event to subscribe to.</p></dd><dt><p><code>webhook_url</code></p></dt><dd><p><code>string</code> The URL (including scheme).</p></dd></dl>

<h3 id="returns">Returns</h3>

<p>Generic <a href="Globals.html#Default Response Object"><code>Success</code></a> object.</p>

<h4 id="errors">Errors</h4>

<dl><dt><p><strong>400 Bad Request</strong></p></dt><dd><p><code>Require {field}.</code>  Occurs when you're missing a necessary NVP parameter.</p></dd><dd><p><code>Invalid field {field}.</code>  Occurs when you have an invalid <code>type</code> field or malformed <code>webhook_url</code>.</p></dd><dt><p><strong>404 Not Found</strong></p></dt><dd><p><code>Event Subscription not found.</code>  Occurs when the event cannot be found.</p></dd><dt><p><strong>500 Internal Server Error</strong></p></dt><dd><p><code>Unable to handle request.</code>  Occurs when there's a system failure while attempting to subscribe to an event.</p></dd></dl>

<h2 id="geteventsidahrefgeteventsididgeteventsidclassdeeplinka">GET /events/{id} <a href="#GET /events/{id}" id="GET /events/{id}" class="deep-link">#</a></h2>

<p>Collection. Gets the event and associated data. A duplicate of what is sent by webhook.</p>

<h3 id="queryparameters">Query Parameters</h3>

<p>None.</p>

<h3 id="returns">Returns</h3>

<p><a href="Objects.html#Event"><code>Event</code></a> Objects.</p>

<h4 id="errors">Errors</h4>

<dl><dt><p><strong>404 Not Found</strong></p></dt><dd><p><code>Event not found.</code>  Occurs when the event cannot be found.</p></dd></dl>
                <hr />
                <small>Documentation generated by <a href="https://github.com/millermedeiros/mdoc">mdoc</a>.</small>
            </div>
        </div>
        <script src="assets_/js/lib/jquery.js"></script>
        <script src="assets_/js/lib/syntax-highlighter/shCore.js"></script>
        <script src="assets_/js/lib/syntax-highlighter/shAutoloader.js"></script>
        <script src="assets_/js/main.js"></script>
    </body>
</html>

